 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
	<head>
    	<meta charset="UTF-8">
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
        <script type="text/javascript" src="devErrorReport.js"></script>
	</head>
 	<body>
    	<h2 style="color:teal">Test Type</h2>
        <input type="radio" name="testType" value="false" id="practiceRadio" /> Practice  <!--Radio buttons for deciding which div to show, final or practice-->
        <input type="radio" name="testType" checked="checked" value="true" id="finalRadio" /> Final
        <div id="practiceDiv">
            <h3 style="color:teal">Practice Exam (Instructor Input)</h3>
            
            <p>low and high WPM must be concentric around the midrange WPM</p>
            <p>These are only for the illustration that happens below and are not important to the test itself</p>
            
            <input id="lowWPM" type="text"  placeholder="low WPM..." 	/>
            <br>
            
            <input id="midWPM" type="text"  placeholder="midrange WPM..." 	/>
            <br>
            <!--WPM high value is calculated to avoid confusion. low, mid and high wpm need to be centered around mid-->
            <input id="highWPM" type="text" readonly="readonly" placeholder="high WPM..." 	/> <--- Is assigned automatically after filling in low and high WPM
            <br>
            
            <input id="PracticeTitle" type="text" name="title" placeholder="Practice title..." 	/>
            <br>
            
            <p>Practice #</p>
            
            <select id="practiceNum" >
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>
            <br/>
                
            <textarea id="practiceText" name="assesment" rows="8" cols="64" placeholder="the instructor will input the material for which the student will be assesed in this box"></textarea>
            <br/>
        	<br/>
            <input id="practiceSubmit" type="button" value="Finished" />
        </div>
        
        <div id="finalDiv" >
        	<h3 style="color:teal">Final Exam (Instructor Input)</h3>
            
            <input id="timeLimit" type="text"  placeholder="time limit (seconds)..." 	/> <---Please enter the time in seconds<br />
            <br />
            
            
            Total points: <input type="text" placeholder="Insert total point"/><br /><br />
            
            <input type="checkbox" id="minusForErrors" /> Subtract <input type="text" style="max-width:20px" id="errorValue" /> 
            <select id="errorValueType">
                <option value="percent">percent</option>
                <option value="points">points</option>
            </select>
            per error
          	<br /><br />
                
                <textarea id="finalText" rows="8" cols="64" placeholder="input test here..."></textarea><br />
            
            
            
   			<input id="finalSubmit" type="button"  value="Finished" />
        </div>
        <div id="result"></div>
        <div id="jsonR"></div>
    </body>
</html>

<script type="text/javascript">	
	
	$("#practiceDiv").hide(); 								//initally hides the final input information						
	
	$("#practiceRadio").change( 						//waits for a change in the "practice" radio. When changed it changes the scene to show the practice information (deafult page load)
		function(){
			if(this.checked){
				$("#finalDiv").hide();
				$("#practiceDiv").show();
			}
		}
	);
	
	$("#finalRadio").change( 							// when "final"radio is chosen, the practice information is hidden and the final information is shown
		function(){
			if(this.checked){
				$("#practiceDiv").hide();
				$("#finalDiv").show();
			}	
		}
	);
	
	
	//the low, mid and high WPM values need to be concesntric around the mid, for the purpose the game, so the high is calculated to avoid confusion and errors
	$("#lowWPM").change(changeValue); 
	$("#midWPM").change(changeValue);
	
	function changeValue(){
		
		var lowWPM = $("#lowWPM").val()*1;				//multiplied by 1 to convert from a string to an int
		var midWPM = $("#midWPM").val()*1;
		
		if( lowWPM != "" && midWPM != ""){
			if(lowWPM  <=  midWPM )
				$("#highWPM").val(2*midWPM - lowWPM); 
				
		}
	}
	
	$("#practiceSubmit").click(stringToJSONPractice);	//attaching event to the submit buttons
	$("#finalSubmit").click(stringToJSONFinal);
	
	
	function stringToJSONPractice(){
		
		var error = false;										//error originally set to false. If a field is not filled out properly, error will be set to true and a message will be displayed
		var errorMessage = "These fields cannot be blank:\n";
		var JSONString = "";
		
		var lowWPM = $("#lowWPM").val();
		var midWPM = $("#midWPM").val();
		
		var title = $("#PracticeTitle").val();
		var text = $("#practiceText").val();
					
		if(lowWPM == ""){
			errorMessage += "low WPM\n";
			error = true;	
		}
		if( midWPM == ""){
			errorMessage += "mid WPM\n";
			error = true;	
		}
		if( title == ""){
			errorMessage += "title\n";
			error = true;	
		}
		if( text == ""){
			errorMessage += "text\n";
			error = true;	
		}
		if(!error){
			//JSON string created with all the necessary information
			JSONString = '{ "lowWPM":' + JSON.stringify(lowWPM) + ', "midWPM":' + JSON.stringify(midWPM) +', "highWPM":' + JSON.stringify($("#highWPM").val()) + ', "title":' + JSON.stringify(title) + ', "practiceNum":' + JSON.stringify($("#practiceNum").val()) + ', "text":' + JSON.stringify(text) + '}';
			//posting to PHP portal which saves file
			$.post(
				"https://isdev.byu.edu/is/dev/Ryan/BrainHoney/testWPMPortal.php",
				{
					"type":"practice",
					"JSONString":JSONString,
					"bhCourseId":window.parent.bhCourseId,
					"bhCourseTitle":window.parent.bhCourseTitle
				},
				function(data) {
  					console.log(data);			//posts success or failure to console
				}
			);
		}else{
			alert(errorMessage);		//creates an alert dialogue with fields needing to be filled out
		}
	}
					
	function stringToJSONFinal(){
		
		//same comments as above but adjusted for final
		
		var error = false;
		var errorMessage = "These fields cannot be blank:\n";
		var JSONString = "";
			
		if($("#timeLimit").val() == ""){
			errorMessage += "time limit\n";
			error = true;	
		}
		if($("#finalText").val() == ""){
			errorMessage += "text\n";
			error = true;	
		}
		
		if(!error){
			JSONString = '{ "timeLimit":' + JSON.stringify($("#timeLimit").val())  + ', "text":' + JSON.stringify($("#finalText").val()) + '}';
			
			$.post(
				"https://isdev.byu.edu/is/dev/Ryan/BrainHoney/testWPMPortal.php",
				{
					"type":"final",
					"JSONString":JSONString,
					"bhCourseId":window.parent.bhCourseId,
					"bhCourseTitle":window.parent.bhCourseTitle
				},
				function(data) {
  					console.log(data);
				}
			);
		}else{
			alert(errorMessage);	
		}
	}
	
</script>